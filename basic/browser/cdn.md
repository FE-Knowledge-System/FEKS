[toc]

# CDN

## 什么是 CDN？
CDN (Content Delivery Network)，内容分发网络。

CDN 是将源站内容分发至最接近用户的节点，使用户可就近取得所需内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。

## 使用 CDN 的优势
* 多域名加载资源
一般情况下，浏览器都会对单个域名下的并发请求数（文件加载）进行限制，通常最多有 4 个，那么第 5 个加载项将会被阻塞，直到前面的某一个文件加载完毕。 
因为 CDN 文件是存放在不同区域（不同IP）的，所以对浏览器来说是可以同时加载页面所需的所有文件（远不止4个），从而提高页面加载速度。
* 文件可能已经被加载过并保存有缓存
一些通用的 js 库或者是 css 样式库，如 jQuery，在网络中的使用是非常普遍的。
当一个用户在浏览你的某一个网页的时候，很有可能他已经通过你网站使用的 CDN 访问过了其他的某一个网站，恰巧这个网站同样也使用了 jQuery，那么此时用户浏览器已经缓存有该 jQuery 文件（同 IP 的同名文件如果有缓存，浏览器会直接使用缓存文件，不会再进行加载），所以就不会再加载一次了，从而间接的提高了网站的访问速度。
* 高效率
你的网站做的再厉害也不会超过百度或谷歌，一个好的 CDNs 会提供更高的效率，更低的网络延时和更小的丢包率。
* 分布式的数据中心
假如你的站点布置在北京，当一个广州用户访问你的站点的时候，他的数据请求势必会很慢很慢。而 CDNs 则会让用户从离他最近的节点去加载所需的文件，所以加载速度提升就是理所当然的了。
* 使用情况分析
一般情况下 CDNs 提供商都会提供数据统计功能，可以了解更多关于用户访问自己网站的情况，可以根据统计数据对自己的站点适时适当的做出调整。
* 有效防止网站被攻击
一般情况下 CDNs 提供商也是会提供网站安全服务的。

## CDN 原理
如果使用了CDN，用户在通过浏览器访问网站的大致过程如下：

![CDN 工作原理](https://raw.githubusercontent.com/FE-Knowledge-System/FEKS/master/basic/browser/pic/cdn.png)

1. 户在浏览器中输入要访问的域名。

2. 浏览器向 DNS 服务器请求对域名进行解析。由于 CDN 对域名解析进行了调整，DNS 服务器会最终将域名的解析权交给 CNAME 指向的 CDN 专用 DNS 服务器。

3. CDN 的 DNS 服务器将 CDN 的负载均衡设备IP地址返回给用户。

4. 用户向 CDN 的负载均衡设备发起内容 URL 访问请求。

5. CDN 负载均衡设备会为用户选择一台合适的缓存服务器提供服务。
  选择的依据包括：
   * 根据用户 IP 地址，判断哪一台服务器距离用户最近；
   * 根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容；
   * 查询各个服务器的负载情况，判断哪一台服务器的负载较小。

基于以上这些依据的综合分析之后，负载均衡设置会把缓存服务器的 IP 地址返回给用户。

6. 用户向缓存服务器发出请求。

7. 缓存服务器响应用户请求，将用户所需内容传送到用户。
如果这台缓存服务器上并没有用户想要的内容，而负载均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉取到本地。

## 参考文献
 * [https://www.360kuai.com/pc/9461cb81b29d9c800?cota=3&kuai_so=1&sign=360_57c3bbd1&refer_scene=so_1](https://www.360kuai.com/pc/9461cb81b29d9c800?cota=3&kuai_so=1&sign=360_57c3bbd1&refer_scene=so_1)
 * [https://www.cnblogs.com/changlon/p/10165053.html](https://www.cnblogs.com/changlon/p/10165053.html)